<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/vazir-font@24.1.0/dist/font-face.css"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-2.2.4.min.js"
      integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
      crossorigin="anonymous"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
      crossorigin="anonymous"
    ></script>
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="images/favicon-32x32.png"
    />
    <link rel="stylesheet" href="style.css" />
    <title>اصناف نزدیک شما | داپ اَپ</title>

  </head>
  <body style="padding-bottom: 100px;">
    <header>
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <img src="images/logo.png" class="logo" alt="" />
            <a href="https://web-customer.daapapp.com/">
              <div class="app-link">
                وب اپلیکیشن
              </div>
            </a>
            <a href="https://landing.daapapp.com/4/">
              <div class="download-link">
                دانلود اپلیکیشن
              </div>
            </a>
          </div>
        </div>
      </div>
    </header>

    <section>
      <div class="container mt-5">
        <div class="row">
          <div class="col-md-3 sub-header-right">
            <img src="images/address.png" class="address-pic" alt="" />
            <div style="padding: 0px 10px;">
              <h4>اصناف اطراف شما</h4>
              <h6 class="sub-header-right-text2">شعاع 500 متر</h6>
            </div>
          </div>
          <div class="col-md-9 border-style">
            <p>
              لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ، و با
              استفاده از طراحان گرافیک است، چاپگرها و متون بلکه روزنامه و مجله
              در ستون و سطرآنچنان که لازم است، و برای شرایط فعلی تکنولوژی مورد
              نیاز، و کاربردهای متنوع با هدف بهبود ابزارهای کاربردی می باشد،
              کتابهای زیادی در شصت و سه درصد گذشته حال و آینده، شناخت فراوان
              جامعه و متخصصان را می طلبد، تا با نرم افزارها شناخت بیشتری را برای
              طراحان رایانه ای علی الخصوص طراحان خلاقی، و فرهنگ پیشرو در زبان
              فارسی ایجاد کرد، در این صورت می توان امید داشت که تمام و و د.
            </p>
          </div>
        </div>
      </div>
    </section>

    <section>
      <div class="container">
        <div class="row">
          <div class="col-md-12 mt-5">
            <div class="accordion" id="accordionExample">
              <!-- <div class="accordion-item">
                          <h2 class="accordion-header" id="headingOne">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                             سوپرمارکت
                            </button>
                          </h2>
                          <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                            <div class="accordion-body">
                              <table class="table caption-top">
                                <thead>
                                  <tr>
                                    <th scope="col" class="table-header-color">ردیف</th>
                                    <th scope="col" class="table-header-color">نام فروشگاه</th>
                                    <th scope="col" class="table-header-color">آدرس</th>
                                    <th scope="col" class="table-header-color">مسیریابی روی نقشه</th>
                                    <th scope="col" class="table-header-color">درصد پاداش نقدی  </th>
                                  </tr>
                                </thead>
                                <tbody id="t">
                             
                                
                                </tbody>
                              </table>
                            </div>
                          </div>
                        </div> -->
              <img src="images/Group 12.png" class="percent-pic" alt="" />
              <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalLabel">آدرس </h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="storeAddres">
                      ...
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن</button>
                      <button type="button" class="btn btn-primary" onclick="showMap()">مشاهده نقشه</button>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
       
        
        </div>
      </div>
    </section>

  

    <script>
    
      var request
     
      if (window.XMLHttpRequest) {
        request = new XMLHttpRequest()
      } else {
        request = new ActiveXObject('Microsoft.XMLHTTP')
      } 
         var store_adresses=document.getElementById("storeAddres")
       
         var Linkurl=window.location.href
      //  request.open('GET', 'data2.json')
       request.open('GET', Linkurl)
         request.onreadystatechange = function () {
        if (request.readyState === 4 && request.status === 200) {
          var items = JSON.parse(request.responseText)
          var percentage =
            '<img src="images/Group 12.png" style="width:25px;float:left" />'
          var badge = '<img src="images/new.png" class="badge-style"  />'
          var rows = []
          let myItems = Object.entries(items)
          myItems.map((item) => {
            var p = "<div class='accordion-item' >"
            p +=
              "<h2 class='accordion-header' id='heading__" +
              item[1][0].business_id +
              "'><button class='accordion-button collapsed' style='height: 45px;' type='button' data-bs-toggle='collapse' data-bs-target='#collapse___" +
              item[1][0].business_id +
              "' aria-expanded='true' aria-controls='collapse___" +
              item[1][0].business_id +
              "'>"
            p += item[0]
            var uniqueName=item[1][0].shop_name
            var myShops=[]
            myShops.push(uniqueName)
            
            // console.log(myShops[0]);
            p += '</button></h2>'
            p +=
              '<div id="collapse___' +
              item[1][0].business_id +
              '" class="accordion-collapse collapse" aria-labelledby="heading__' +
              item[1][0].business_id +
              '" data-bs-parent="#accordionExample"> <div class="accordion-body ">'
            p +=
              '<table class="table caption-top"><thead><tr><th scope="col" class="table-header-color rows">ردیف</th><th scope="col" class="table-header-color shop_names">نام فروشگاه</th><th scope="col" class="table-header-color res-address">آدرس</th><th scope="col" class="table-header-color">مسیریابی  </th><th scope="col" class="table-header-color percent-row">درصد پاداش   </th></tr></thead>'
            p += '<tbody>'
            item[1].forEach((store, index) => {

              p += "<tr><td class='rows'>" + (index + 1 || ' ') + '</td>'
              if (store.show_badge == true) {
    
                p += '<td>' + store.shop_name + badge + '</td>'
              } else {
                p +=
                  "<td class='shop_names'>" + store?.shop_name || '' + '</td>'
              }

              p += "<td class='res-address'>" + store?.address || '' + '</td>'
              if (store.latitude && store.longitude ) {
               
                if (navigator.userAgent.match(/Mobile/)) {
                  //
                  //
                  //
                  var str='onclick="myfunc(`'+store.address+'`,`'+store.latitude+'`,`'+store.longitude+'`)"'
                  p +='<td> ' +
                    '<span class="map-text sec-title" >' +
                    '<img src="images/pin.png" data-bs-toggle="modal" data-bs-target="#exampleModal" '+str+' />' +
                    '</span>'
               
                
                } 
                
                else {
                  p +=
                    '<td>' +
                    '<span class="map-text sec-title"  onclick="getMap(' +
                    store.latitude +
                    ',' +
                    store.longitude +
                    ')">' +
                    'نقشه' +
                    '</span>' +
                    '</td>'
                }
              }

              
              if (store.double_cashback_percentage !== null) {
                p +=
                  "<td class='percent-row' >" +
                  '<span style="position:relative;float:right"><span class="line-delete"></span>' +
                  '%' +
                  store.cashback_percentage +
                  '</span>' +
                  '<span class="res-cash-number">' +
                  percentage +
                  '</span>' +
                  '<span style="color:red;padding: 0 10px;font-weight:bolder;float: right;">' +
                  '%' +
                  store.double_cashback_percentage +
                  '</span>' +
                  '</td>'
              } else {
                p +=
                  "<td class='percent-row'>" +
                  '%' +
                  store.cashback_percentage +
                  '</td>'
              }

              p += '</tr>'
            })
            p += '</tbody></div></div>'
            rows.push(p)
          })
          rows.forEach((row) => {
            document.getElementById('accordionExample').innerHTML += row
          })
        }
      }
      request.send()

    

      function getMap(lat, lng) {
        localStorage.setItem('lat', lat)
        localStorage.setItem('lng', lng)
        window.location.href = 'map.html'
      }
var loc=null
function myfunc(address,lat,lng){
 console.log(lat,lng);
loc={
  lat:lat,
  lng:lng
}
  var store_adresses=document.getElementById("storeAddres") 
store_adresses.innerText=address;

}

function showMap() {
        localStorage.setItem('lat', loc.lat)
        localStorage.setItem('lng', loc.lng)
        window.location.href = 'map.html'
}
   
    </script>


  </body>
</html>
